<!DOCTYPE html>
<html>
  <head>
    <title>Git Gud</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <canvas id="canvas" width="640" height="480">
      Get a real browser!
    </canvas>
    <div id="controls">
      <div id="histories">
        <ul id="githist">
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
        </ul><ul id="history">
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
          <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
        </ul>
      </div>
      <div id="textenter">
        <span id="locked-text">&gt;&nbsp;git&nbsp;</span><input id="input-box-cmd" autocomplete="off" spellcheck="false" autofocus="autofocus" type="text" maxlength="32" />
      </div>
    </div>
    
    <script src="./git-gud.js"></script>
    <script src="./api.js"></script>

    <script>
      const HISTORY = document.getElementById("history");
      const GIT_PREF = document.getElementById("githist");
      const PROMPT = document.getElementById("locked-text");
      const INPUT = document.getElementById("input-box-cmd");
      const CANVAS = document.getElementById("canvas");
      const CONTROLS = document.getElementById("controls");

      HISTORY.onclick = _ => INPUT.focus();

      window.addEventListener('resize', _ => {
        CANVAS.width = window.innerWidth;
        CANVAS.height = window.innerHeight - CONTROLS.clientHeight;
      });
      window.dispatchEvent(new FocusEvent("resize"));

      function addToHistory(text, prefix) {
        let hLI = document.createElement("LI");
        hLI.innerHTML = text;
        HISTORY.appendChild(hLI);
        let gLI = document.createElement("LI");
        gLI.innerHTML = prefix || "&nbsp;";
        GIT_PREF.appendChild(gLI);
        if (HISTORY.children.length > 5) {
          HISTORY.removeChild(HISTORY.children[0]);
          GIT_PREF.removeChild(GIT_PREF.children[0]);
        }
      }

      let initConfirm = false;
      INPUT.onkeydown = e => {
        if (e.keyCode !== 13) return true;
        let command = INPUT.value.toLowerCase();
        INPUT.value = "";
        addToHistory(command, initConfirm ? false : "git&nbsp;");

        let split = command.split(' ');
        if (initConfirm) {
          if (command == 'y') {
            init();
            PROMPT.innerHTML = "> git&nbsp;";
            initConfirm = false;
          } else if (command == 'n') {
            PROMPT.innerHTML = "> git&nbsp;";
            initConfirm = false;
          } else {
            addToHistory("<span style='color:white'>Please enter either 'y' or 'n'.</span>", "y/n&nbsp;");
          }
        } else if (split[0] == "init") {
          addToHistory("<span style='color:white'>This will reset your tree. Are you sure?</span>", "y/n&nbsp;");
          PROMPT.innerHTML = "[y/n]&nbsp;";
          initConfirm = true;
        } else if (split[0] == "commit") {
          commit();
        } else if (split[0] == "branch") {
          branch();
        } else if (split[0] == "merge") {
          merge(split[1]);
        } else if (split[0] == "checkout") {
          checkout(split[1]);
        } else {
          addToHistory("<span style='color:red'>Invalid command!</span>");
        }

        e.preventDefault(); return false;
      }

//       var i=0;
//       var flag=0;
//       function noenter() {
//         return !(window.event && window.event.keyCode == 13); 
//       }
//       var commands = [];
//       function hist(){
//         commands.push(document.getElementById("input-box-cmd").value);
//         var old = document.getElementById("history").innerHTML;
//         var x;
//         if(flag==1 && (document.getElementById("input-box-cmd").value=="y" || document.getElementById("input-box-cmd").value=="n")){
//             x = document.getElementById("input-box-cmd").value;
//         }
//         else if(bad==1){
//             x = document.getElementById("input-box-cmd").value;
// //            bad=0;
//         }
//         else{
//             x = /*"git " +*/ document.getElementById("input-box-cmd").value;
//         }
//         document.getElementById("input-box-cmd").value = "" ;

//         if(i==0){
//           document.getElementById("history").innerHTML = x ;
//         }
//         else{
//             if(flag==1 && (x=="y" || x=="n")){
//                 document.getElementById("history").innerHTML = old + " " + x;
//             }
//             else{
//             document.getElementById("history").innerHTML = old + "<br />" + x;
//             }
//         }
//         i=i+1;
                
//         document.getElementById("history").scrollTop = document.getElementById("history").scrollHeight ;
//         action_process(x);

// //        return false;
//       }
//       var bad=0;
//       function action_process(x){
//           var x_split = x.split(' ');
//           var text_hist = document.getElementById("history").innerHTML;
//           var text="Invalid command entered";
//           var warning_text="This action is not reversible, Do you want to proceed [y/n]"
//           try {
//               if(flag==1 || x_split[1] == "init"){
//                   if(flag==0){
//                   document.getElementById("history").innerHTML = text_hist + "<br />" + "<span style='color:yellow;'>" + warning_text + "</span>" ;
//                   document.getElementById("locked-text").innerHTML = "[y/n]";
//                   document.getElementById("input-box-cmd").style.width = "424px";
//                   bad=1;
//                   }
//                   if(flag!=0){
//                       bad=0;
//                   }
//                   flag=1;
//                   console.log(x_split);
//                   if(x_split[0] == "y"){
//                   document.getElementById("locked-text").innerHTML = "&gt;&nbsp;git&nbsp;";
//                   document.getElementById("input-box-cmd").style.width = "412px";
//                   flag=0;
//                   bad=0;
//                   init();
//                   }
//                   else if(x_split[0] == "n"){
//                   flag=0;
//                   bad=0;
//                   document.getElementById("locked-text").innerHTML = "&gt;&nbsp;git&nbsp;";
//                   document.getElementById("input-box-cmd").style.width = "412px";
//                   }
//                   else if(bad==0 && (x_split[0]!="y" || x_split[0]!="n")){
//                   document.getElementById("history").innerHTML = text_hist + "<br />" + "<span style='color:yellow;'>" + "Please enter a valid choice" + "</span>" ;
//                   bad=1;
//                   }
                  
//               }
//               else if(x_split[1] == "commit" && x_split[2]==null){
//                   commit();
//               }
//               else if(x_split[1] == "branch" && x_split[2]==null){
//                   branch();
//               }
//               else if(x_split[1] == "merge" && x_split[2]!=null){
//                   merge(x_split[2]);
//               }
//               else if(x_split[1] == "checkout" && x_split[2]!=null){
//                   checkout(x_split[2]);
//               }
//               else{
//                   document.getElementById("history").innerHTML = text_hist + "<br />" + "<span style='color:red;'>" + text + "</span>" ;
//               }
//               document.getElementById("history").scrollTop = document.getElementById("history").scrollHeight ;
//           } catch (e) {
//             console.log("Type: " + typeof(e));
//             console.log("Message:", e);
//           }
//       }
    </script>
  </body>
</html>
