#ifndef GIT_GUD_HPP
#define GIT_GUD_HPP

#include <memory>
#include <vector>
#include <map>

namespace git_gud
{

	/**
	 * Commits make the nodes of the GitTree. Each may have several
	 * parents and several children. Each MUST have a unique ID.
	 *
	 * @author Michael Bianconi
	 */
	class Commit
	{

		private:

			int commitID;
			int branchID;

			std::vector<std::shared_ptr<Commit> > parents;
			std::vector<std::shared_ptr<Commit> > children;

			/**
			 * @return Returns a unique, sequential ID.
			 */
			int generateID();

		public:

			/**
			 * Creates a new Commit on the specified branch and with
			 * a unique ID.
			 *
			 * @param branchID The ID of the branch.
			 */
			Commit(int branchID); // autogenerated ID

			/**
			 * Creates a new Commit on the specified branch.
			 *
			 * @param branchID The ID of the branch.
			 * @param commitID The ID of the commit.
			 */
			Commit(int branchID, int commitID); // pregenerated ID

			int getID() const;
			int getBranch() const;
			std::vector<std::shared_ptr<Commit> >& getParents();
			std::vector<std::shared_ptr<Commit> >& getChildren();

			void addParent(std::shared_ptr<Commit> parent);
			void addChild(std::shared_ptr<Commit> child);

			// not implemented
			void removeParent(int id);
			void removeChild(int id);

			void print();
	};

	class GitTree
	{
		private:

			std::shared_ptr<Commit> head;
			std::vector<std::shared_ptr<Commit> > commits;
			int numBranches = 0;

			int generateBranchID();

		public:

			GitTree();

			std::shared_ptr<Commit> getHead() const;
			std::shared_ptr<Commit> getCommit(int ID) const;
			std::shared_ptr<Commit> getLatest() const;
			std::shared_ptr<Commit> getLatest(int branchID) const;

			std::vector<std::shared_ptr<Commit> >& getAllCommits();
			int getNumBranches() const;
			int getNumCommits() const;

			/**
			 * Generates a new Commit as a child of the head.
			 * Checks out the new Commit.
			 *
			 * @return Returns the generated Commit.
			 */
			std::shared_ptr<Commit> addCommit();

			/**
			 * Generates a new Commit as a child of the specified parent,
			 * on the same branch. Checks out the new Commit.
			 */
			std::shared_ptr<Commit> addCommit(int parentID);

			/**
			 * Generates a new Commit as a child of the specified parent,
			 * on a new branch.
			 */
			std::shared_ptr<Commit> addCommitNewBranch(int parentID);

			/**
			 * Sets the head of the tree.
			 *
			 * @param commitID ID of the commit to set as the head.
			 */
			void checkout(int commitID);

			/**
			 * Sets the head of the tree.
			 *
			 * @param Commit to set.
			 */
			void checkout(std::shared_ptr<Commit> commit);

			/**
			 * Removes the last Commit from the tree. If there is
			 * only one node, do nothing.
			 */
			void undo();

			void print() const;
	};
}

#endif